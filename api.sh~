#!/bin/bash

curl -X POST --header "Content-Type: application/x-www-form-urlencoded" -d "grant_type=refresh_token&refresh_token=mfklITVnKww1YzbRRlo6OnNAnnnbREV1SqEosjwORN4g63M8QfkpPADC2LEo8Nd9tOoqMHnOpU/+/Q5csfZPaC2lUHeIzOd7B4ycKYGF8xvQc76QqpULBsUV6TwPrZslBfCQChcf1WCFtWa3QBJQj5ESYdZd1n/E4u8uwhQqA/faypePR/jPddlyrGvpUeFhKeVsoUGFlsKBui2PvVsffcGVzuZlNVg1pIXzIw/NuEaTVKDRtyP1Iw+OImVrdnJctOtmvXR1MILYFSUPIfppZgt6lFvUWOru2tl5Mh7uB6yf3vB91/qR4Dnlo/uKyK1f8d/UjtXNtoSZvyE3fjbps5VAVAx7UV3yNslIz/JtLsufd5FGPlxGnfAjw62aoFEWouwg2bjZuN8qX4P5zVxjHB67H5g+r+Y5Cyv4dptWnIgTWKu/0BRTp9qKWk/100MQuG4LYrgoVi/JHHvlPcNyUs7JJyQRIRmQg2PHZ6x7+yFW/RNpYMAbFZfOU3U9A3pNT+nlCsLK4j1wltrEfnlE9/GpOEikJwp0rWi6WLp4h/gfo+cBrfYVG7jGaRlIjCfJazE4phW5xFnFS+nPjMTdUqQr6pfemy9AM7w9sKAYXzieDCPN5Sg6sUo3Ex6V+mRyn3mePcS4cx+yeU/9L6mIjfJU9tLuas6ig4IyUeWQJYNvEBAkvBzL4+ohhCF53rFKfoYj55bAXi+hHUOlZ73zPCjWvTuARP+YYZTLdu+XxrjatAVg8Xm+a9ghmWnyMSXNWcmYHZre0YhROBSbvSr8wg3R/2QeXerBEO2mOJc1OjKY8NUaARJ5BSc5LLPM0Dp3/t01dBVswnI+Nv8IZKnIEvCavePlGi3krmj07L6HQjSwmRVLiAsikNJChTUzEG1+RjGfBRCRskc=212FD3x19z9sWBHDJACbC00B75E&access_type=offline&code=&client_id=H2PZBDOKOS3FLTGOPRBD0A9GX6UILCJL%40AMER.OAUTHAP&redirect_uri=https%3A%2F%2F127.0.0.1" "https://api.tdameritrade.com/v1/oauth2/token" >> docs/keys.json


REFRESH=$(grep -oP '"access_token" :\K[^,]*' docs/keys.json)
REFRESH=${REFRESH:2:-1}

input="stockList.txt"
while IFS= read -r line
do
      curl -X GET --header "Authorization: Bearer AgU9w97nF9eejQOlH+mTobAMaFcsSOSsZgLACULcB5yrfkaIG8ezyWkSn9gLwMj7qn8EvvSSTtfARzxTcfJE+T+3cEAaGaD3Oz4rDj3JVmw+cF8s7fo4Qv4wjUJa+yTom54+eUqEnbzbOKZ05WS3zu0aGnRERo/aI0m4nY1SvaXc+HLDn7VD0Fec1EEJX5pO1b9m6QRJ5Db8U7Ls8qTNhVapUCfSpE/GXhpIDW0o3C8tbvsJ7FHOuPnV0OLfRsLp1dcst8HFrf6u8Z/YMozbCgcVkwgxPtAuUucxvium7k5XhX+ZTKjM0wzPK7QMD6HdeIfPrhFkrf++/OtHIQZ7wcFW0DC8k9DCFEk3eOi8VNiWkxHh72YVuXvgfeFigIMGQ7rwcyh3KR3GOhiOl+A8SQUf5R1tP/m7ovt92TBTd3oRxS1X1Kir/H6FrjWk7LdwoW6OyEO+xxIOB396xAoFP0KNM1qVEsjIKRtbW0MdE9Tdlw/SHVkbgFt6qSwTFyjENBMX2beZnXS1pdfx+5VSfRxQBTfNhwKcnuUN1fuUZvQZBH6mdSQ4h3q4/biJTobBBwf0SRT7yjw2dWzAA100MQuG4LYrgoVi/JHHvl/bnsNpXS84LfK/LWFrc+pxBHBLbEQzUVNWmCDEfLRqjQJ4+ehGQ1LJ0GVrIjI8BXdIdaPbRNqLdqPmbS2TOJKATCO50GYoMkS+jFGSwoRzCcsZOgsBcBVhjZBqJobvxYP1EIeRw6MmKGuhi0TBWasjNWCVpMVRMdc6Y9nzmd3euqiELQCx5agpZIEkNqv+F79xgWDdl0Z5oLBb1o5SMpYluyY2yo7K8usyjYXVOQDt5Up37VO0ISR45bWTpmU1xxgWQu2F0ayAMA8Q8l08vWPgQEOUcJHE+fMkrGTs8LkyJFM8KIz6ir9T8tspvKVoqP6If7eBCx4vhoSxEeTDqG3f1aFNcVXvfeJLuHh7IzdT95b7AWh0EC2I9cyTNZ2H4fjAeZYVccjI57HjkKQBGy5wqXvmLJtASuZf25XQR9SOHNlb2uSnD37QQ3zQxcXaPlJCjRVhVYCHNxC/pD0HW+LP1++kvXUgYo7kQrgi7Y2JKf0nnh+gLWYGGuEfTV915SCVxv+bG2WkAS8aWzl8C9g+JgTReWAde9x0M6o1vYsVMBscGdKMJljw/bTFCWy9G5LvvgYyoKean5+zWQ==212FD3x19z9sWBHDJACbC00B75E" "https://api.tdameritrade.com/v1/marketdata/${line}/pricehistory?apikey=H2PZBDOKOS3FLTGOPRBD0A9GX6UILCJL&periodType=year&period=20&frequencyType=daily&frequency=1&needExtendedHoursData=false" >> docs/exampleJSONData/${line}_data.json
done < "$input"
